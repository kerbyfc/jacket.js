(function(){root=this;this.__bind=function(b,a){return function(){return b.apply(a,arguments)}};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"a".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});var k=Object.getPrototypeOf([]).forEach,l=0;"undefined"===typeof this._&&(this._={each:function(b,a,c){if("object"===typeof b)if(k&&b.forEach===k)b.forEach(a,c);else if(b.length===+b.length)for(var d=0,f=b.length;d<f&&a.call(c,b[d],
d,b)!=={};d++);else for(d in b)if({}.hasOwnProperty.call(b,d)&&a.call(c,b[d],d,b)==={})break},isArray:function(b){return"[object Array]"==toString.call(b)},has:function(b,a){return Object.hasOwnProperty.call(b,a)},uniqueId:function(b){var a=++l+"";return b?b+a:a}});var g=this._,e=function(b,a,c,d){"string"!==typeof b&&(d=c,c=a,a=b,b="");"undefined"===typeof root._?e.err("Jacket needs underscore.js (http://underscorejs.org) to implement it`s functionality."):("function"===typeof c&&(d=c),g.isArray(c)||
(c=[]),g.isArray(e.protected_methods)&&g.each(e.protected_methods,function(a){c.push(a)}),"undefined"===typeof d&&(d=e.callback),a=new e.Wearer(a,d,c,b));return this instanceof e?function(){return"function"===typeof a?new a(arguments):a}:a};e.callstack=[];e.config={log_errors:!0,log_stacktrace:!0,log_callstack:!0,use_debugger:!1,throw_errors:!0,notify_url:!1};e.log=function(){try{console.log.apply(console,arguments)}catch(b){}};e.err=function(){try{console.error.apply(console,arguments)}catch(b){this.log.apply(this,
arguments)}};e.trace=function(b){return(" - "+b.slice(1).join("\n - ")).replace(/(\-)+\s{2,}/g,"$1 ")};e.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;e.handle=function(b,a){var c=b.message;"string"===typeof a&&(c=a+c);this.config.log_errors&&this.err(c);if(this.config.use_debugger)debugger;var d=[];g.each(printStackTrace({e:b}),function(a){null===a.match(/eval|_fn_wrapper/)&&d.push(a)});this.config.log_stacktrace&&this.log(this.trace(d));this.config.log_callstack&&
this.log(this.callstack);this.config.notify_url&&("string"===typeof this.config.notify_url&&null!==this.config.notify_url.match(e.url)?this.notify({date:(new Date).toString(),message:c,stacktrace:d,callstack:this.callstack}):this.err("Jacket.config.notify_url (<"+typeof this.config.notify_url+"> "+this.config.notify_url+") must be a correct url string."));"function"===typeof this.handler&&this.handler(b,c,d,this.callstack);if(this.config.throw_errors)throw b;};e.sensor=function(b){var a=0;return function(c,
d){if(0!==a&&"object"===typeof b&&"object"==typeof d&&b==d)return"[Circular]";if(100<=a)return"[Unknown]";++a;return d}};e.notify=function(b){var a=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:void 0;if(a){a.open("POST",this.config.notify_url,!0);a.setRequestHeader("Content-Type","application/json;charset=UTF-8");var c;try{c=JSON.stringify(b,e.sensor(b))}catch(d){return b.callstack="[Circular]",e.notify(b)}a.send(c)}return a};e.protected_methods=
[];e.protect=function(){if("object"===typeof arguments[0])return e.protect.apply(this,arguments[0]);g.each(arguments,function(b){"string"===typeof b&&e.protected_methods.push(b)});return e.protected_methods};e.callback=null;var m=Jacket=e,h=function(b,a,c,d){var f,j=typeof b;if("object"===j||"function"===j){this.origin=b;this.fname=d.length?d:b.name||"";this.wrap=this.bind(this.wrap,this);this.callback=a;this.protect(c);if(!this.fname.length)switch(j){case "function":this.fname=g.uniqueId("Anonymous");
break;default:this.fname=g.uniqueId("Unnamed")}!1!=this.origin.name?this.wrap_class():this.wrap_object_or_function();for(f in this.origin)g.has(this.origin,f)&&(this.wrapper[f]=this.wrap(f,this.origin[f]))}else Jacket.handle(Error("Only functions and objects can wear Jacket"));console.log(this.wrapper);return this.wrapper};h.members=[];h.prototype.bind=function(b,a){return function(){return b.apply(a,arguments)}};h.prototype.wrap_object_or_function=function(){var b=this;"function"===typeof this.origin?
(this.wrapper=this.wrap("constructor",this.origin,!0),this.wrapper.prototype=this.origin.prototype,g.each(Object.getPrototypeOf(this.wrapper.prototype),function(a,c,d){g.has(d,c)&&(b.wrapper.prototype[c]=b.wrap(c,a))})):(this.wrapper={},g.each(this.origin,function(a,c,d){g.has(d,c)&&(b.wrapper[c]=b.wrap(c,a))}))};h.prototype.wrap_class=function(){var b=this,a=g.uniqueId(this.fname);this.parse_function(this.origin.toString());console.log("Wrapp class",a);Jacket.Wearer.members[a]={scope:b,origin:this.origin};
this._constructor=this.wrap("constructor",this.origin,!0);var c="Jacket.Wearer.members['"+a+"'].wrapper = (function(_super, _wrapper) {\n  \n  _wrapper.extend("+this.fname+", _super, _wrapper);\n  \n  "+this.fname+'.name = "'+this.fname+'";\n  \n  function '+this.fname+"() {\n\n    _wrapper._constructor.apply(this, arguments);\n\n    var _self = this; _.each(this, function (val, key) {\n      _self[key] = _wrapper.wrap(key, val);\n    });\n\n  }\n\n  return "+this.fname+";\n\n})(Jacket.Wearer.members['"+
a+"'].origin, Jacket.Wearer.members['"+a+"'].scope);\n";root.execScript?root.execScript(c):root.eval.call(root,c);this.wrapper=h.members[a].wrapper;this.wrapper.prototype.wrap=this.wrap;g.each(Object.getPrototypeOf(this.wrapper.prototype),function(a,c,j){g.has(j,c)&&(b.wrapper.prototype[c]=b.wrap(c,a))})};h.prototype.protect=function(b){var a=this;this.protected_methods={__super__:1,constructor:1};g.each(b,function(b){a.protected_methods[b]=1});return this.protected_methods};h.prototype.extend=function(b,
a,c){function d(){this.constructor=b}for(var f in a)g.has(a,f)&&(b[f]=c.wrap(f,a[f],b));d.prototype=a.prototype;b.prototype=new d;b.__super__=a.prototype;return b};h.prototype.parse_function=function(b){b=b.replace(/(\n)/g,"{n}").match(/^function[\s]+[\w]*\(([\w\s,_\$]*)?\)[\s]*\{(.*)\}[\s]*$/);var a=[];b&&(b[1]&&(a=b[1].match(/((?!=^|,)([\w\$_]))+/g)),a.unshift(b[2].replace(/\{n\}/g,"\n")));0<a.length&&(a[0]="try { "+a[0]+' \n    } catch (e) { \n      Jacket.handle(e, _wrapper.fname + ".constructor : "); \n    }');
return a=[a[0],a.slice(1)||[]]};h.prototype.wrap=function(b,a,c){var d=this;"function"===typeof b&&(a=b,b=g.uniqueId("anonymous"));console.log("wrap",typeof this.origin,d.fname+"."+b,"[",typeof a,"]");return c||"function"===typeof a&&!g.has(a,"wrapped")&&!g.has(this.protected_methods,b)?(c=function(){var c={scope:d.fname,method:b,args:arguments,time:(new Date).getTime()};try{c.result=a.apply(this,arguments),"function"===typeof d.callback&&d.callback(d.fname||d.origin,b,arguments,result),Jacket.callstack.push(c)}catch(j){Jacket.handle(j,
d.fname+"."+b+" : ")}return c.result},c.wrapped=!0,c):a};m.Wearer=h;"undefined"===typeof printStackTrace&&(printStackTrace=function a(c){c=c.e||null;return(new a.implementation).run(c)},"undefined"!==typeof module&&module.exports&&(module.exports=printStackTrace),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(a,c){a=a||this.createException();c=c||this.mode(a);return"other"===c?this.other(arguments.callee):this[c](a)},createException:function(){try{this.undef()}catch(a){return a}},
mode:function(a){return a.arguments&&a.stack?"chrome":a.stack&&a.sourceURL?"safari":a.stack&&a.number?"ie":"string"===typeof a.message&&"undefined"!==typeof window&&window.opera?!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":!a.stack?"opera10a":0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11":a.stack?"firefox":"other"},chrome:function(a){a=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,
"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");a.pop();return a},safari:function(a){return a.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(a){return a.stack.replace(/at Anonymous function /gm,"{anonymous}()@").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^.*at (\w+) \(([^\)]+)\)$/gm,"$1@$2").split("\n")},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,
"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(a){var c=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;a=a.stacktrace.split("\n");for(var d=[],f=0,j=a.length;f<j;f+=2){var e=c.exec(a[f]);if(e){var g=e[4]+":"+e[1]+":"+e[2],e=e[3]||"global code",e=e.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");d.push(e+"@"+g+" -- "+a[f+1].replace(/^\s+/,""))}}return d},opera10b:function(a){var c=/^(.*)@(.+):(\d+)$/;a=a.stacktrace.split("\n");
for(var d=[],f=0,e=a.length;f<e;f++){var g=c.exec(a[f]);g&&d.push((g[1]?g[1]+"()":"global code")+"@"+g[2]+":"+g[3])}return d},opera10a:function(a){var c=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;a=a.stacktrace.split("\n");for(var d=[],f=0,e=a.length;f<e;f+=2){var g=c.exec(a[f]);g&&d.push((g[3]||"{anonymous}")+"()@"+g[2]+":"+g[1]+" -- "+a[f+1].replace(/^\s+/,""))}return d},opera9:function(a){var c=/Line (\d+).*script (?:in )?(\S+)/i;a=a.message.split("\n");for(var d=[],f=2,e=a.length;f<
e;f+=2){var g=c.exec(a[f]);g&&d.push("{anonymous}()@"+g[2]+":"+g[1]+" -- "+a[f+1].replace(/^\s+/,""))}return d},other:function(a){for(var c=/function\s*([\w\-$]+)?\s*\(/i,d=[],f,e;a&&a.arguments&&10>d.length;)f=c.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}",e=Array.prototype.slice.call(a.arguments||[]),d[d.length]=f+"("+this.stringifyArguments(e)+")",a=a.caller;return d},stringifyArguments:function(a){for(var c=[],d=Array.prototype.slice,f=0;f<a.length;++f){var e=a[f];void 0===e?c[f]=
"undefined":null===e?c[f]="null":e.constructor&&(e.constructor===Array?c[f]=3>e.length?"["+this.stringifyArguments(e)+"]":"["+this.stringifyArguments(d.call(e,0,1))+"..."+this.stringifyArguments(d.call(e,-1))+"]":e.constructor===Object?c[f]="#object":e.constructor===Function?c[f]="#function":e.constructor===String?c[f]='"'+e+'"':e.constructor===Number&&(c[f]=e))}return c.join(",")}},this.printStackTrace=printStackTrace);"undefined"!==typeof module&&module.exports&&(Jacket.is_node=!0,module.exports=
Jacket);if(void 0!==typeof define)try{define(function(){return Jacket})}catch(n){}return this.Jacket=this.J=Jacket}).call(this);